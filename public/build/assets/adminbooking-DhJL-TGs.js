import{r as a,j as e,u as he,J as ye,R as Ne}from"./app-DJ4blC9j.js";import{A as Se}from"./AdminLayout-C1ZXbyz1.js";import{S as ee,a as te,b as se,c as ae,d as U,C as Ce}from"./Calendar-CdXtC8b2.js";import{n as ke,c as xe}from"./utils-WuXrF6sg.js";import{S as _e,D as De,a as $e,s as Me,T as Re,R as Ee}from"./reservationTable-C0N3ZFnI.js";import{P as Te}from"./x-CMtLTFRa.js";import"./check-BnU_BktV.js";const Le=({isOpen:C,onClose:f,onDateSelect:j,selectedDate:u,onMonthSelect:y,selectedMonth:$,selectedYear:w})=>{const[m,x]=a.useState(()=>u?new Date(u).toLocaleString("default",{month:"long"}):new Date().toLocaleString("default",{month:"long"})),[g,n]=a.useState(()=>u?new Date(u).getFullYear():new Date().getFullYear()),[S,p]=a.useState(!1),[M,b]=a.useState(g),[V,R]=a.useState(!1),[J,E]=a.useState(!1),k=["January","February","March","April","May","June","July","August","September","October","November","December"],_=(i,h)=>{const N=k.indexOf(i);return new Date(h,N+1,0).getDate()},H=(i,h)=>{const N=k.indexOf(i);return new Date(h,N,1).getDay()},I=i=>{const h=k.indexOf(m),N=new Date(g,h,i),v=N.getFullYear(),Y=String(N.getMonth()+1).padStart(2,"0"),O=String(i).padStart(2,"0");return`${v}-${Y}-${O}`},B=i=>{const h=I(i);console.log("Selected date:",h),j(h),f()},G=()=>{j(null),f()},F=()=>{const i=k.indexOf(m);i===0?(x("December"),n(g-1)):x(k[i-1])},l=()=>{const i=k.indexOf(m);i===11?(x("January"),n(g+1)):x(k[i+1])},T=()=>{y?y(m,g):j(null),f()},L=()=>{const i=_(m,g),h=H(m,g),N=[];for(let v=0;v<h;v++)N.push(e.jsx("div",{className:"h-8"},`empty-${v}`));for(let v=1;v<=i;v++){const Y=I(v),O=u===Y;N.push(e.jsx("div",{onClick:()=>B(v),className:`cursor-pointer transition-colors h-8 flex items-center justify-center rounded-lg font-lexend ${O?"bg-olive text-beige":"text-[#3f411a] hover:bg-olive hover:text-beige"}`,children:v},v))}return N},z=new Date().getFullYear();return Array.from({length:6},(i,h)=>z+h),C?e.jsx("div",{className:"fixed inset-0 bg-black/20 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-background rounded p-8 shadow-lg max-w-lg w-full mx-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold text-[#3f411a] font-lexend",children:"Select Date"}),e.jsx("button",{onClick:f,className:"text-gray-500 hover:text-gray-700 text-2xl font-bold",children:"×"})]}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("button",{onClick:F,className:"p-2 rounded hover:bg-olive-light hover:text-beige-light transition-colors","aria-label":"Previous Month",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsxs("div",{className:"relative mx-2 flex-1 flex justify-center",children:[e.jsxs("button",{onClick:()=>{p(!S),b(g)},className:"px-4 py-2 text-lg font-semibold text-[#3f411a] font-lexend rounded hover:bg-gray-300 transition-colors text-center whitespace-nowrap",style:{minWidth:140},children:[m," ",g]}),S&&e.jsxs("div",{className:"absolute left-1/2 -translate-x-1/2 mt-3 bg-background border border-gray-400 rounded-lg shadow-lg z-10 min-w-[380px] p-4",children:[e.jsxs("div",{className:"relative mb-4",children:[e.jsx("button",{onClick:()=>b(M-1),className:"absolute left-0 top-1/2 -translate-y-1/2 p-2 rounded hover:bg-olive-light hover:text-beige-light transition-colors",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsx("span",{className:"block text-xl font-semibold text-[#3f411a] font-lexend select-none text-center",children:M}),e.jsx("button",{onClick:()=>b(M+1),className:"absolute right-0 top-1/2 -translate-y-1/2 p-2 rounded hover:bg-olive-light hover:text-beige-light transition-colors",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]}),e.jsx("div",{className:"grid grid-cols-3 gap-1 mb-4",children:k.map(i=>e.jsx("button",{onClick:()=>{x(i),n(M),p(!1)},className:`flex items-center justify-center px-6 py-3 hover:bg-olive hover:text-beige cursor-pointer transition-colors rounded font-lexend text-olive text-sm ${i===m&&M===g?"bg-olive text-beige  font-medium":""}`,children:i},i))}),e.jsx("button",{onClick:()=>p(!1),className:"w-full mt-2 px-3 py-2 text-base text-olive font-lexend bg-gray-200 hover:bg-gray-300 text-gray-700 transition-colors cursor-pointer rounded",children:"Close"})]})]}),e.jsx("button",{onClick:l,className:"p-2 rounded hover:bg-olive-light hover:text-beige-light transition-colors","aria-label":"Next Month",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]}),e.jsxs("div",{className:"grid grid-cols-7 text-center gap-y-2 mb-4",children:[["Su","Mo","Tu","We","Th","Fr","Sa"].map(i=>e.jsx("div",{className:"text-base font-medium text-gray-500 font-lexend",children:i},i)),L()]}),e.jsx("div",{className:"mb-4",children:e.jsx("button",{onClick:T,className:"w-full bg-olive-light hover:bg-olive text-beige py-2 px-4 rounded-lg transition-colors font-lexend text-base",children:"Select This Month"})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:G,className:"flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 py-2 px-4 rounded-lg transition-colors font-lexend text-base",children:"Clear"}),e.jsx("button",{onClick:f,className:"flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 py-2 px-4 rounded-lg transition-colors font-lexend text-base",children:"Close"})]})]})}):null},Fe=({isOpen:C,onClose:f,onConfirm:j,title:u,message:y,type:$})=>C?e.jsx("div",{className:"fixed inset-0 bg-black/20 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-background text-olive rounded p-6 shadow-lg max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-xl mb-4 font-lexend font-semibold tracking-tighter",children:u}),e.jsx("p",{className:"text-olive mb-6 font-lexend font-light tracking-tight",children:y}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:f,className:"flex-1 bg-[hsl(var(--destructive))] hover:bg-[hsl(var(--destructive)/0.8)] text-white border-none py-3 px-4 rounded font-regular transition-colors font-lexend cursor-pointer",children:"No"}),e.jsx("button",{onClick:j,className:"flex-1 bg-olive hover:bg-olive-light text-white border-none py-3 px-4 rounded font-regular transition-colors font-lexend cursor-pointer",children:"Yes"})]})]})}):null,fe=({isOpen:C,onClose:f,onReservationCreated:j,timeSlots:u,systemSettings:y})=>{const{showNotification:$}=he(),[w,m]=a.useState(new Date().getMonth()),[x,g]=a.useState(new Date().getFullYear()),[n,S]=a.useState(u.length>0?u[0].id:null),[p,M]=a.useState(y.min_guest_size||1),[b,V]=a.useState(null),[R,J]=a.useState(""),[E,k]=a.useState(""),[_,H]=a.useState(""),[I,B]=a.useState("63"),[G,F]=a.useState(""),[l,T]=a.useState([]),[L,z]=a.useState([]),[i,h]=a.useState([]),[N,v]=a.useState([]),[Y,O]=a.useState({}),[W,Q]=a.useState(!1),K=["January","February","March","April","May","June","July","August","September","October","November","December"],ne=[new Date().getFullYear(),new Date().getFullYear()+1,new Date().getFullYear()+2],re=new Date,s=new Date(re.getTime()+y.max_advance_booking_days*24*60*60*1e3);a.useEffect(()=>{o(),D(),q()},[w,x]);const o=async()=>{try{const r=await(await fetch(`/reservations/fully-booked-dates?month=${w+1}&year=${x}`)).json();h(r.fully_booked_dates||[])}catch(t){console.error("Error fetching fully booked dates:",t),h([])}},D=async()=>{try{const r=await(await fetch(`/reservations/closed-dates?month=${w+1}&year=${x}`)).json();v(r.closed_dates||[])}catch(t){console.error("Error fetching closed dates:",t),v([])}},q=async()=>{try{const r=await(await fetch(`/reservations/special-hours-dates?month=${w+1}&year=${x}`)).json(),c={};r.special_hours_data&&r.special_hours_data.forEach(d=>{c[d.day]={special_start:d.special_start,special_end:d.special_end}}),O(c)}catch(t){console.error("Error fetching special hours dates:",t),O({})}},X=t=>{const r=new Date(x,w,t);r.setHours(0,0,0,0);const c=new Date;return c.setHours(0,0,0,0),!!(r<=c||r>s||N.includes(t))},P=t=>i.includes(t),me=t=>N.includes(t),oe=t=>Y.hasOwnProperty(t),ie=t=>Y[t]||null,ge=async t=>{try{const c=await(await fetch(`/reservations/occupied-time-slots?date=${t}`)).json();T(c.occupied_time_slots||[]),z(c.disabled_time_slots||[])}catch(r){console.error("Error fetching occupied time slots:",r),T([]),z([])}},pe=t=>{V(t);const r=`${x}-${String(w+1).padStart(2,"0")}-${String(t).padStart(2,"0")}`;if(ge(r),oe(t))S("special-hours");else{const c=u.find(d=>!l.includes(d.id)&&!L.includes(d.id));S((c==null?void 0:c.id)||null)}};a.useEffect(()=>{if(n&&typeof n=="number"&&(l.includes(n)||L.includes(n))){const t=u.find(r=>!l.includes(r.id)&&!L.includes(r.id));S((t==null?void 0:t.id)||null)}},[l,L,n,u]);const be=()=>{const t=[];if(b){const c=new Date(x,w,b).toLocaleDateString("en-US",{weekday:"long"}),d=K[w];t.push(`${d} ${b} (${c})`)}if(n)if(n==="special-hours"){const r=ie(b);r&&t.push(`${r.special_start} - ${r.special_end} (Special Hours)`)}else{const r=u.find(c=>c.id===n);r&&t.push(r.start_time_formatted)}return t.push(`${p} Guest${p>1?"s":""}`),!b&&!n?"Select date and time":t.join(", ")},le=()=>b&&n&&(n==="special-hours"||!l.includes(n)&&!L.includes(n))&&R.trim()&&E.trim()&&_.trim()&&I.trim()&&_.includes("@")&&_.includes("."),ce=(t,r)=>{/^[a-zA-Z\s]*$/.test(t)&&r(t)},ve=t=>{H(t)},je=t=>{/^[\d\s\-\+]*$/.test(t)&&t.length<=15&&B(t)},we=async()=>{var t;if(le()){Q(!0);try{const r={guest_first_name:R.trim(),guest_last_name:E.trim(),guest_email:_.trim(),guest_phone:I.trim(),special_requests:G.trim(),reservation_date:`${x}-${String(w+1).padStart(2,"0")}-${String(b).padStart(2,"0")}`,time_slot_id:n==="special-hours"?null:n,guest_count:p,is_special_hours:n==="special-hours"},d=await(await fetch("/staff/quick-reservation",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((t=document.querySelector('meta[name="csrf-token"]'))==null?void 0:t.getAttribute("content"))||""},body:JSON.stringify(r)})).json();d.success?($("Reservation created successfully!","success"),j&&j(),de()):$(d.message||"Failed to create reservation","error")}catch(r){console.error("Error creating reservation:",r),$("An error occurred while creating the reservation","error")}finally{Q(!1)}}},de=()=>{m(new Date().getMonth()),g(new Date().getFullYear()),S(u.length>0?u[0].id:null),M(y.min_guest_size||1),V(null),J(""),k(""),H(""),B(""),F(""),T([]),z([]),h([]),v([]),O({}),Q(!1),f()};return C?e.jsx("div",{className:"fixed inset-0 bg-black/20 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-[#3f411a] rounded shadow-lg max-w-6xl w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-10",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-3xl text-beige font-lexend font-extralight",children:"QUICK RESERVATION"}),e.jsx("button",{onClick:de,className:"text-white cursor-pointer text-3xl font-bold hover:text-beige transition-colors",children:"×"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsx("div",{className:"flex flex-col justify-start h-full",children:e.jsxs("div",{className:"flex flex-col justify-start h-full",children:[e.jsxs("div",{className:"flex space-x-4 mb-10",children:[e.jsxs("div",{className:"relative w-40",children:[e.jsx("label",{className:"block text-base font-extralight font-lexend mb-2 text-white",children:"Month"}),e.jsxs(ee,{value:w.toString(),onValueChange:t=>{m(parseInt(t)),V(null)},children:[e.jsx(te,{className:"bg-transparent border-b border-white text-white w-full pr-8 py-2 text-base font-extralight font-lexend rounded-none border-t-0 border-l-0 border-r-0 focus:ring-0 focus:ring-offset-0 px-0 h-auto",children:e.jsx(se,{})}),e.jsx(ae,{className:"bg-[#3f411a] border-white text-white max-h-none overflow-y-visible",children:K.map((t,r)=>e.jsx(U,{value:r.toString(),className:"bg-[#3f411a] font-extralight font-lexend text-white hover:bg-[#5a5d2a] focus:bg-[#5a5d2a]",children:t},t))})]})]}),e.jsxs("div",{className:"relative w-28",children:[e.jsx("label",{className:"block text-base font-extralight font-lexend mb-2 text-white",children:"Year"}),e.jsxs(ee,{value:x.toString(),onValueChange:t=>g(parseInt(t)),children:[e.jsx(te,{className:"bg-transparent border-b border-white text-white w-full pr-8 py-2 text-base font-extralight font-lexend rounded-none border-t-0 border-l-0 border-r-0 focus:ring-0 focus:ring-offset-0 px-0 h-auto",children:e.jsx(se,{})}),e.jsx(ae,{className:"bg-[#3f411a] border-white text-white",children:ne.map(t=>e.jsx(U,{value:t.toString(),className:"bg-[#3f411a] font-extralight font-lexend text-white hover:bg-[#5a5d2a] focus:bg-[#5a5d2a]",children:t},t))})]})]}),e.jsxs("div",{className:"relative w-40",children:[e.jsx("label",{className:"block text-base font-extralight font-lexend mb-2 text-white",children:"Time"}),e.jsxs(ee,{value:(n==null?void 0:n.toString())||"",onValueChange:t=>{S(t==="special-hours"?"special-hours":parseInt(t))},children:[e.jsx(te,{className:`bg-transparent border-b border-white text-white w-full font-extralight font-lexend rounded-none border-t-0 border-l-0 border-r-0 focus:ring-0 focus:ring-offset-0 px-0 h-auto text-left ${n==="special-hours"?"py-3 text-xs":"py-2 text-base"}`,children:e.jsx(se,{children:(()=>{if(n==="special-hours")return"Special Hours";if(n&&typeof n=="number"){const t=u.find(r=>r.id===n);return t?t.start_time_formatted:""}return""})()})}),e.jsx(ae,{className:"bg-[#3f411a] border-white text-white",children:(()=>{const t=b?ie(b):null;return t?e.jsxs(U,{value:"special-hours",className:"bg-[#3f411a] font-extralight font-lexend text-white hover:bg-[#5a5d2a] focus:bg-[#5a5d2a]",children:[t.special_start," - ",t.special_end," (Special Hours)"]}):u.map(r=>{const c=l.includes(r.id),d=L.includes(r.id),Z=c||d;return e.jsxs(U,{value:r.id.toString(),className:`bg-[#3f411a] font-extralight font-lexend focus:bg-[#5a5d2a] relative ${Z?"cursor-not-allowed":"hover:bg-[#5a5d2a]"} ${c?"!opacity-100":""} ${d?"!opacity-100":""}`,disabled:Z,children:[e.jsx("span",{className:c?"text-[#D4847C]":d?"text-[#5295bb]":"text-white",children:r.start_time_formatted}),c&&e.jsx("div",{className:"absolute right-2 top-1/2 transform -translate-y-1/2 w-2 h-2 bg-[#D4847C] rounded-full opacity-100"}),d&&!c&&e.jsx("div",{className:"absolute right-2 top-1/2 transform -translate-y-1/2 w-2 h-2 bg-[#5295bb] rounded-full opacity-100"})]},r.id)})})()})]})]}),e.jsxs("div",{className:"relative w-24",children:[e.jsx("label",{className:"block text-base font-extralight font-lexend mb-2 text-white",children:"Guests"}),e.jsxs(ee,{value:p.toString(),onValueChange:t=>M(parseInt(t)),children:[e.jsx(te,{className:"bg-transparent border-b border-white text-white w-full pr-8 py-2 text-base font-extralight font-lexend rounded-none border-t-0 border-l-0 border-r-0 focus:ring-0 focus:ring-offset-0 px-0 h-auto",children:e.jsx(se,{children:p})}),e.jsx(ae,{className:"bg-[#3f411a] border-white text-white",children:(()=>{const t=y.min_guest_size||1,r=y.max_guest_size||10,c=[];for(let d=t;d<=r;d++)c.push(d);return c.map(d=>e.jsx(U,{value:d.toString(),className:"bg-[#3f411a] font-extralight font-lexend text-white hover:bg-[#5a5d2a] focus:bg-[#5a5d2a]",children:d},d))})()})]})]})]}),e.jsx(Ce,{selectedMonth:w,selectedYear:x,selectedDate:b,onDateSelect:pe,isDateDisabled:X,isDateFullyBooked:P,isDateClosed:me,isDateSpecialHours:oe,months:K,className:"grid grid-cols-7 text-center gap-y-7 text-white text-lg",dayClassName:(t,{isDisabled:r,isFullyBooked:c,isSelected:d,isClosed:Z,isSpecialHours:ue})=>{let A="transition-colors w-8 h-8 flex items-center justify-center font-lexend font-extralight relative";return Z?A+=" text-[#5295bb] cursor-not-allowed":c?A+=" text-[#D4847C] cursor-not-allowed":d&&ue?A+=" bg-[#f6f5c6] text-[#C5A572] font-semibold rounded-full cursor-pointer":d?A+=" bg-[#f6f5c6] text-[#3f411a] font-semibold rounded-full cursor-pointer":ue?A+=" text-[#C5A572] hover:text-beige-dark cursor-pointer":r?A+=" text-gray-400 cursor-not-allowed":A+=" text-white hover:text-beige-dark cursor-pointer",A}}),e.jsxs("div",{className:"flex justify-center items-center space-x-6 mt-6",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-[#D4847C]"}),e.jsx("span",{className:"text-white font-extralight font-lexend text-sm",children:"Fully Booked"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-[#C5A572]"}),e.jsx("span",{className:"text-white font-extralight font-lexend text-sm",children:"Special Hours"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-[#5295bb]"}),e.jsx("span",{className:"text-white font-extralight font-lexend text-sm",children:"Closed"})]})]})]})}),e.jsxs("div",{className:"flex flex-col justify-between h-full self-stretch w-full max-w-md ml-auto",children:[e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-base font-extralight font-lexend mb-3 text-white",children:"When"}),e.jsx("div",{className:"border-b border-white pb-2 text-lg font-extralight font-lexend text-white",children:be()})]}),e.jsxs("div",{className:"flex space-x-6",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-base font-extralight font-lexend mb-2 text-white",children:"First Name"}),e.jsx("input",{type:"text",value:R,onChange:t=>ce(t.target.value,J),className:"w-full bg-transparent border-b border-white text-white pb-2 outline-none text-base font-extralight font-lexend",placeholder:"First name",required:!0})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-base font-extralight font-lexend mb-2 text-white",children:"Last Name"}),e.jsx("input",{type:"text",value:E,onChange:t=>ce(t.target.value,k),className:"w-full bg-transparent border-b border-white text-white pb-2 outline-none text-base font-extralight font-lexend",placeholder:"Last name",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-base font-extralight font-lexend mb-2 text-white",children:"Email"}),e.jsx("input",{type:"email",value:_,onChange:t=>ve(t.target.value),className:"w-full bg-transparent border-b border-white text-white pb-2 outline-none text-base font-extralight font-lexend",placeholder:"Enter your email",required:!0})]}),e.jsxs("div",{className:"flex space-x-6",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-base font-extralight font-lexend mb-2 text-white",children:"Phone Number"}),e.jsx("input",{type:"tel",value:I,onChange:t=>je(t.target.value),className:"w-full bg-transparent border-b border-white text-white pb-2 outline-none text-base font-extralight font-lexend",placeholder:"+1 234 567 8901",required:!0})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-base font-extralight font-lexend mb-2 text-white",children:"Special Requests"}),e.jsx("input",{type:"text",value:G,onChange:t=>F(t.target.value),className:"w-full bg-transparent border-b border-white text-white pb-2 outline-none text-base font-extralight font-lexend",placeholder:"ex. Food Allergies"})]})]})]}),e.jsx("button",{onClick:we,disabled:!le()||W,className:`block w-full text-center font-extralight font-lexend py-4 mt-8 text-lg transition duration-200 ${le()&&!W?"bg-white text-[#3f411a] hover:bg-[#f6f5c6] cursor-pointer":"bg-gray-400 text-gray-600 cursor-not-allowed"}`,children:W?"Creating Reservation...":"Create Reservation"})]})]})]})})}):null},Oe=({status:C,onReservationUpdate:f,endpointPrefix:j,timeSlots:u,systemSettings:y})=>{const{showNotification:$}=he(),[w,m]=a.useState([]),[x,g]=a.useState(null),[n,S]=a.useState(!1),[p,M]=a.useState(""),[b,V]=a.useState("date-asc"),[R,J]=a.useState(()=>new Date().toISOString().split("T")[0]),[E,k]=a.useState(null),[_,H]=a.useState(null),[I,B]=a.useState(!1),[G,F]=a.useState(!1),[l,T]=a.useState(null),[L,z]=a.useState(!1);a.useEffect(()=>{S(!0),fetch(`${j||"/admin"}/api/reservations?status=${C}`).then(s=>s.json()).then(s=>{let o=s.reservations||[];C==="all"&&(o=o.filter(D=>D.status!=="pending")),m(o),S(!1)})},[C,j]);const i=a.useCallback(s=>{g(x===s?null:s)},[x]),h=a.useMemo(()=>w.filter(s=>{const o=s.guest_first_name.toLowerCase().includes(p.toLowerCase())||s.guest_last_name.toLowerCase().includes(p.toLowerCase())||s.email.toLowerCase().includes(p.toLowerCase())||s.phone.toLowerCase().includes(p.toLowerCase());let D=!0;if(R)D=ke(s.reservation_date)===R;else if(E&&_){const q=new Date(s.reservation_date),X=q.toLocaleString("default",{month:"long"}),P=q.getFullYear();D=X===E&&P===_}return o&&D}),[w,p,R,E,_]),N=a.useMemo(()=>[...h].sort((s,o)=>{switch(b){case"firstName-asc":return s.guest_first_name.localeCompare(o.guest_first_name);case"firstName-desc":return o.guest_first_name.localeCompare(s.guest_first_name);case"lastName-asc":return s.guest_last_name.localeCompare(o.guest_last_name);case"lastName-desc":return o.guest_last_name.localeCompare(s.guest_last_name);case"timeSlot-am-pm":return xe(s.time_slot||"",o.time_slot||"");case"timeSlot-pm-am":return xe(o.time_slot||"",s.time_slot||"");case"guest-asc":return s.guest_count-o.guest_count;case"guest-desc":return o.guest_count-s.guest_count;case"date-asc":return s.reservation_date.localeCompare(o.reservation_date);case"date-desc":return o.reservation_date.localeCompare(s.reservation_date);default:return 0}}),[h,b]),v=a.useCallback((s,o,D)=>{T({type:"complete",reservationId:s,reservationName:`${o} ${D}`}),F(!0)},[]),Y=a.useCallback((s,o,D)=>{T({type:"cancel",reservationId:s,reservationName:`${o} ${D}`}),F(!0)},[]),O=a.useCallback(async()=>{var s;if(l)try{const o=l.type==="complete"?`${j||"/admin"}/api/reservations/${l.reservationId}/complete`:`${j||"/admin"}/api/reservations/${l.reservationId}/cancel`,q=await(await fetch(o,{method:"PATCH",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((s=document.querySelector('meta[name="csrf-token"]'))==null?void 0:s.getAttribute("content"))||""}})).json();q.success?(m(X=>X.map(P=>P.id===l.reservationId?{...P,status:l.type==="complete"?"completed":"cancelled"}:P)),$(`Reservation ${l.type==="complete"?"completed":"cancelled"} successfully!`,"success"),f&&f()):$(`Failed to ${l.type} reservation: ${q.message}`,"error")}catch{$(`Failed to ${l.type} reservation. Please try again.`,"error")}finally{F(!1),T(null)}},[l,j,f,$]),W=a.useCallback(()=>{F(!1),T(null)},[]),Q=a.useCallback(s=>{J(s),k(null),H(null)},[]),K=a.useCallback((s,o)=>{k(s),H(o),J(null)},[]),ne=s=>new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),re=()=>R?ne(R):E&&_?`${E} ${_}`:"Date";return e.jsxs("div",{className:"bg-white border border-primary-light h-[450px] shadow p-6 flex flex-col",children:[e.jsxs("div",{className:"flex gap-4 mb-2",children:[e.jsx(_e,{value:p,onChange:s=>M(s.target.value),placeholder:"Search by guest name, email, number or details...",className:"flex-1 basis-[55%]"}),e.jsx(De,{onClick:()=>B(!0),label:re(),className:"basis-[15%]"}),e.jsx($e,{value:b,onChange:V,options:Me,className:"basis-[30%]"})]}),n?e.jsx("div",{className:"text-center py-8 font-lexend font-light text-gray-500",children:"Loading..."}):N.length===0?e.jsx("div",{className:"text-center py-8 font-lexend text-gray-500",children:"No reservations found."}):e.jsx("div",{className:"w-full flex-1 min-h-0 overflow-y-auto",children:e.jsx(Re,{children:e.jsxs("table",{className:"w-full text-left font-lexend table-fixed",children:[e.jsxs("colgroup",{children:[e.jsx("col",{style:{width:"170px"}}),e.jsx("col",{style:{width:"90px"}}),e.jsx("col",{style:{width:"105px"}}),e.jsx("col",{style:{width:"80px"}}),e.jsx("col",{style:{width:"70px"}}),e.jsx("col",{style:{width:"95px"}}),e.jsx("col",{style:{width:"95px"}})]}),e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 bg-white sticky top-0 z-0",children:[e.jsx("th",{className:"py-3 px-5 font-semibold tracking-tighter truncate",children:"First Name"}),e.jsx("th",{className:"py-3 px-2 font-semibold tracking-tighter truncate",children:"Last Name"}),e.jsx("th",{className:"py-3 px-2 font-semibold tracking-tighter truncate text-center",children:"Reservation Date"}),e.jsx("th",{className:"py-3 px-1 font-semibold tracking-tighter truncate text-center",children:"Time Slot"}),e.jsx("th",{className:"py-3 px-1 font-semibold tracking-tighter truncate text-center",children:"Guests"}),e.jsx("th",{className:"py-3 px-1 font-semibold tracking-tighter text-center truncate",children:"Status"}),e.jsx("th",{className:"py-3 px-1 font-semibold tracking-tighter text-center truncate",children:"Actions"})]})}),e.jsx("tbody",{children:N.map(s=>e.jsx(Ee,{reservation:s,expanded:x===s.id,onExpand:()=>i(s.id),onComplete:()=>v(s.id,s.guest_first_name,s.guest_last_name),onCancel:()=>Y(s.id,s.guest_first_name,s.guest_last_name)},s.id))})]})})}),e.jsx(Le,{isOpen:I,onClose:()=>B(!1),onDateSelect:Q,onMonthSelect:K,selectedDate:R,selectedMonth:E,selectedYear:_}),e.jsx(Fe,{isOpen:G,onClose:W,onConfirm:O,title:(l==null?void 0:l.type)==="complete"?"Complete Reservation":"Cancel Reservation",message:`Are you sure you want to ${l==null?void 0:l.type} the reservation for ${l==null?void 0:l.reservationName}?`,type:(l==null?void 0:l.type)||"complete"}),u&&y&&e.jsx(fe,{isOpen:L,onClose:()=>z(!1),onReservationCreated:()=>{S(!0),fetch(`${j||"/admin"}/api/reservations?status=${C}`).then(s=>s.json()).then(s=>{let o=s.reservations||[];C==="all"&&(o=o.filter(D=>D.status!=="pending")),m(o),S(!1)}),f&&f()},timeSlots:u,systemSettings:y})]})},Ie=[{label:`CONFIRMED
RESERVATION`,color:"border-primary-light bg-primary-light text-primary",activeColor:"border-olive bg-olive text-white ring-2 ring-primary ring-offset-2",status:"confirmed"},{label:`COMPLETED
RESERVATION`,color:"border-primary-light bg-primary-light text-primary",activeColor:"border-olive bg-olive text-white ring-2 ring-primary ring-offset-2",status:"completed"},{label:`CANCELLED
RESERVATION`,color:"border-primary-light bg-primary-light text-primary",activeColor:"border-olive bg-olive text-white ring-2 ring-primary ring-offset-2",status:"cancelled"},{label:`ALL
RESERVATION`,color:"border-primary-light bg-primary-light text-primary",activeColor:"border-olive bg-olive text-white ring-2 ring-primary ring-offset-2",status:"all"}],Ve=()=>{const{timeSlots:C,systemSettings:f}=ye().props,[j,u]=a.useState({confirmed:0,completed:0,cancelled:0,all:0}),[y,$]=a.useState("all"),[w,m]=a.useState(!1),x=()=>{fetch("/admin/api/reservation-counts").then(n=>n.json()).then(n=>{u({confirmed:n.confirmed||0,completed:n.completed||0,cancelled:n.cancelled||0,all:n.all||0})}).catch(n=>{console.error("Error fetching counts:",n)})};a.useEffect(()=>{x()},[]);const g=()=>{x()};return e.jsxs(Se,{children:[e.jsxs("div",{className:"flex flex-col items-center px-12 py-10",children:[e.jsx("p",{className:"text-olive text-7xl font-thin font-lexend text-center",children:"BOOKING"}),e.jsx("div",{className:"w-50 h-[1px] bg-olive mt-6",style:{opacity:.5}})]}),e.jsx("div",{className:"px-12 flex gap-6 mb-8",children:Ie.map((n,S)=>e.jsx("button",{className:`flex-1 border-2 p-8 font-lexend font-light text-xl transition-all duration-300 cursor-pointer hover:scale-[1.03] ${y===n.status?n.activeColor:n.color}`,onClick:()=>$(n.status),children:e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx("span",{children:n.label.split(`
`).map((p,M)=>e.jsxs(Ne.Fragment,{children:[p,e.jsx("br",{})]},M))}),e.jsx("span",{className:"mt-4 text-4xl font-bold tracking-wide",children:j[n.status]})]})},n.label))}),e.jsxs("div",{className:"px-12",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-2xl text-[#3f411a] font-lexend font-light",children:"Reservations"}),e.jsxs("button",{onClick:()=>m(!0),className:"bg-[#3c4119] text-sm text-white font-lexend font-light border-none px-6 py-4 hover:bg-[#525a1f] transition-colors flex items-center gap-2",children:[e.jsx(Te,{size:18})," New Reservation"]})]}),e.jsx(Oe,{status:y,onReservationUpdate:g,timeSlots:C,systemSettings:f}),e.jsx(fe,{isOpen:w,onClose:()=>m(!1),onReservationCreated:g,timeSlots:C,systemSettings:f})]})]})};export{Ve as default};
