import{J as le,r as l,j as e,t as se,S as ce,u as oe,R as ae}from"./app-D4IaeF40.js";import{S as G,a as V,b as H,c as W,d as Q}from"./select-kjGqlmna.js";import{C as ie}from"./Calendar-D9GXNItm.js";import"./utils-kWyodwa4.js";const de=()=>{const{url:d}=le(),[x,f]=l.useState(!1),i=()=>{f(!0)},g=()=>{ce.post("/logout")},p=()=>{f(!1)},h=[{id:"dashboard",label:"Dashboard",href:"/staff/dashboard"}],r=(d.startsWith("/staff/dashboard"),"dashboard");return e.jsxs("div",{className:"fixed top-0 left-0 h-screen w-64 bg-olive text-white flex flex-col shadow-xl z-20 border-r border-olive-light",children:[e.jsx("div",{className:"p-6 border-b border-olive-light",children:e.jsx(se,{href:"/staff/dashboard",className:"block overflow-hidden",children:e.jsx("img",{src:"/assets/images/lyma.png",alt:"Lyma by Chef Mar",className:"w-full h-16 object-cover object-center",style:{objectPosition:"center",objectFit:"cover",transform:"scale(3)",transformOrigin:"center"}})})}),e.jsx("nav",{className:"flex-1 pb-6",children:h.map(o=>e.jsxs(se,{href:o.href,className:`w-full flex items-center px-6 py-5 text-left font-lexend font-extralight transition-all duration-200 ease-in-out ${r===o.id?"bg-[#5a5d2a] text-[#f6f5c6]":"text-[#e8e6b3] hover:bg-[#5a5d2a] hover:text-[#f6f5c6]"}`,children:[e.jsx("span",{className:"mr-3 transition-transform duration-200 ease-in-out group-hover:scale-110",children:o.id==="dashboard"&&e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1.2em",height:"1.2em",viewBox:"0 0 24 24",children:e.jsxs("g",{fill:"none",stroke:"currentColor","stroke-width":"1.5",children:[e.jsx("path",{d:"M2 12.204c0-2.289 0-3.433.52-4.381c.518-.949 1.467-1.537 3.364-2.715l2-1.241C9.889 2.622 10.892 2 12 2s2.11.622 4.116 1.867l2 1.241c1.897 1.178 2.846 1.766 3.365 2.715S22 9.915 22 12.203v1.522c0 3.9 0 5.851-1.172 7.063S17.771 22 14 22h-4c-3.771 0-5.657 0-6.828-1.212S2 17.626 2 13.725z"}),e.jsx("path",{"stroke-linecap":"round",d:"M12 15v3"})]})})}),e.jsx("span",{className:"transition-all duration-200 ease-in-out font-lexend",children:o.label})]},o.id))}),e.jsx("div",{className:"p-6 border-t border-[#5a5d2a]",children:e.jsxs("button",{onClick:i,className:"flex items-center text-[#e8e6b3] hover:text-[#f6f5c6] hover:bg-[#5a5d2a] transition-all duration-200 ease-in-out rounded-md w-full font-lexend ",children:[e.jsx("span",{className:"mr-3 transform -scale-x-100 transition-transform duration-200 ease-in-out hover:scale-110",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1.2em",height:"1.2em",viewBox:"0 0 24 24",children:e.jsx("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"1.5",d:"M13.496 21H6.5c-1.105 0-2-1.151-2-2.571V5.57c0-1.419.895-2.57 2-2.57h7M16 15.5l3.5-3.5L16 8.5m-6.5 3.496h10"})})}),e.jsx("span",{className:"transition-all duration-200 ease-in-out font-lexend font-extralight",children:"Logout"})]})}),x&&e.jsx("div",{className:"fixed inset-0 bg-black/20 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-[#3f411a] text-white rounded-2xl p-6 shadow-lg max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-xl  mb-4 font-extralight font-lexend",children:"Confirm Logout"}),e.jsx("p",{className:"text-beige-dark mb-6 font-extralight font-lexend",children:"Are you sure you want to logout?"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:p,className:"flex-1 bg-[#f6f5c6] hover:bg-[#e8e6b3]/80 text-[#3f411a] py-3 px-4 rounded-md font-extralight transition-colors font-lexend",children:"No"}),e.jsx("button",{onClick:g,className:"flex-1 bg-[#f6f5c6] hover:bg-[#e8e6b3]/80 text-[#3f411a] py-3 px-4 rounded-md font-extralight transition-colors font-lexend",children:"Yes"})]})]})})]})},xe=({children:d})=>e.jsxs("div",{className:"min-h-screen bg-beige-light relative",children:[e.jsx("div",{className:"fixed top-0 left-0 h-full z-10",children:e.jsx(de,{})}),e.jsx("div",{className:"ml-64",children:d})]}),ue=({isOpen:d,onClose:x,onDateSelect:f,selectedDate:i,onMonthSelect:g,selectedMonth:p,selectedYear:h})=>{const[u,r]=l.useState(()=>i?new Date(i).toLocaleString("default",{month:"long"}):new Date().toLocaleString("default",{month:"long"})),[o,F]=l.useState(()=>i?new Date(i).getFullYear():new Date().getFullYear()),[w,_]=l.useState(!1),[S,T]=l.useState(!1),N=["January","February","March","April","May","June","July","August","September","October","November","December"],C=(n,b)=>{const j=N.indexOf(n);return new Date(b,j+1,0).getDate()},I=(n,b)=>{const j=N.indexOf(n);return new Date(b,j,1).getDay()},y=n=>{const b=N.indexOf(u),j=new Date(o,b,n),v=j.getFullYear(),L=String(j.getMonth()+1).padStart(2,"0"),A=String(n).padStart(2,"0");return`${v}-${L}-${A}`},D=n=>{const b=y(n);console.log("Selected date:",b),f(b),x()},k=()=>{f(null),x()},E=()=>{const n=N.indexOf(u);n===0?(r("December"),F(o-1)):r(N[n-1])},z=()=>{const n=N.indexOf(u);n===11?(r("January"),F(o+1)):r(N[n+1])},M=n=>{r(n),_(!1)},Y=n=>{F(n),T(!1)},O=()=>{g?g(u,o):f(null),x()},c=()=>{const n=C(u,o),b=I(u,o),j=[];for(let v=0;v<b;v++)j.push(e.jsx("div",{className:"h-8"},`empty-${v}`));for(let v=1;v<=n;v++){const L=y(v),A=i===L;j.push(e.jsx("div",{onClick:()=>D(v),className:`cursor-pointer transition-colors h-8 flex items-center justify-center rounded-lg ${A?"bg-[#f6f5c6] text-[#3f411a]":"text-[#3f411a] hover:bg-[#f6f5c6] hover:text-[#3f411a]"}`,children:v},v))}return j},$=new Date().getFullYear(),B=Array.from({length:6},(n,b)=>$+b);return d?e.jsx("div",{className:"fixed inset-0 bg-black/20 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-lg max-w-sm w-full mx-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold text-[#3f411a] font-lexend",children:"Select Date"}),e.jsx("button",{onClick:x,className:"text-gray-500 hover:text-gray-700 text-2xl font-bold",children:"Ã—"})]}),e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("button",{onClick:E,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx("svg",{className:"w-5 h-5 text-[#3f411a]",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>_(!w),className:"px-3 py-1 text-lg font-semibold text-[#3f411a] font-lexend hover:bg-gray-100 rounded-lg transition-colors",children:[u,e.jsx("svg",{className:"w-4 h-4 ml-1 inline",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),w&&e.jsx("div",{className:"absolute top-full left-0 mt-1 bg-white border border-gray-200 rounded-lg shadow-lg z-10 min-w-[120px]",children:N.map(n=>e.jsx("button",{onClick:()=>M(n),className:`block w-full text-left px-3 py-2 hover:bg-gray-100 transition-colors font-lexend ${n===u?"bg-[#f6f5c6] text-[#3f411a]":"text-[#3f411a]"}`,children:n},n))})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>T(!S),className:"px-3 py-1 text-lg font-semibold text-[#3f411a] font-lexend hover:bg-gray-100 rounded-lg transition-colors",children:[o,e.jsx("svg",{className:"w-4 h-4 ml-1 inline",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),S&&e.jsx("div",{className:"absolute top-full left-0 mt-1 bg-white border border-gray-200 rounded-lg shadow-lg z-10 min-w-[80px]",children:B.map(n=>e.jsx("button",{onClick:()=>Y(n),className:`block w-full text-left px-3 py-2 hover:bg-gray-100 transition-colors font-lexend ${n===o?"bg-[#f6f5c6] text-[#3f411a]":"text-[#3f411a]"}`,children:n},n))})]})]}),e.jsx("button",{onClick:z,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx("svg",{className:"w-5 h-5 text-[#3f411a]",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]}),e.jsx("div",{className:"mb-4",children:e.jsx("button",{onClick:O,className:"w-full bg-[#f6f5c6] hover:bg-[#e8e6b3] text-[#3f411a] py-2 px-4 rounded-lg transition-colors font-lexend text-sm",children:"Select This Month"})}),e.jsxs("div",{className:"grid grid-cols-7 text-center gap-y-2 mb-4",children:[["Su","Mo","Tu","We","Th","Fr","Sa"].map(n=>e.jsx("div",{className:"text-sm font-medium text-gray-500 font-lexend",children:n},n)),c()]}),e.jsxs("div",{className:"flex gap-3",children:[i&&e.jsx("button",{onClick:k,className:"flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 py-2 px-4 rounded-lg transition-colors font-lexend",children:"Clear"}),e.jsx("button",{onClick:x,className:"flex-1 bg-[#f6f5c6] hover:bg-[#e8e6b3] text-[#3f411a] py-2 px-4 rounded-lg transition-colors font-lexend",children:"Close"})]})]})}):null},fe=({isOpen:d,onClose:x,onConfirm:f,title:i,message:g,type:p})=>d?e.jsx("div",{className:"fixed inset-0 bg-black/20 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-[#3f411a] text-white rounded-2xl p-6 shadow-lg max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-xl mb-4 font-lexend font-extralight",children:i}),e.jsx("p",{className:"text-[#f6f5c6] mb-6 font-lexend font-extralight",children:g}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:x,className:"flex-1 bg-red-200 hover:bg-red-300 text-red-900 border-red-400 border-2 py-3 px-4 rounded-md font-extralight transition-colors font-lexend",children:"No"}),e.jsx("button",{onClick:f,className:"flex-1 bg-green-200 hover:bg-green-300 text-green-900 border-green-400 border-2 py-3 px-4 rounded-md font-extralight transition-colors font-lexend",children:"Yes"})]})]})}):null,he=({isOpen:d,onClose:x,onReservationCreated:f,timeSlots:i,systemSettings:g})=>{const{showNotification:p}=oe(),[h,u]=l.useState(new Date().getMonth()),[r]=l.useState(new Date().getFullYear()),[o,F]=l.useState(i.length>0?i[0].id:null),[w,_]=l.useState(1),[S,T]=l.useState(null),[N,C]=l.useState(""),[I,y]=l.useState(""),[D,k]=l.useState(""),[E,z]=l.useState("63"),[M,Y]=l.useState([]),[O,c]=l.useState([]),[$,B]=l.useState(!1),n=["January","February","March","April","May","June","July","August","September","October","November","December"],b=new Date;new Date(b.getTime()+g.max_advance_booking_days*24*60*60*1e3),l.useEffect(()=>{j()},[h,r]);const j=async()=>{try{const a=await(await fetch(`/reservations/fully-booked-dates?month=${h+1}&year=${r}`)).json();c(a.fully_booked_dates||[])}catch(t){console.error("Error fetching fully booked dates:",t),c([])}},v=t=>{const a=new Date(r,h,t);a.setHours(0,0,0,0);const m=new Date;if(m.setHours(0,0,0,0),a<=m)return!0;const R=new Date(m.getTime()+g.max_advance_booking_days*24*60*60*1e3);return a>R},L=t=>O.includes(t),A=async t=>{try{const m=await(await fetch(`/reservations/occupied-time-slots?date=${t}`)).json();Y(m.occupied_time_slots||[])}catch(a){console.error("Error fetching occupied time slots:",a),Y([])}},Z=t=>{T(t);const a=`${r}-${String(h+1).padStart(2,"0")}-${String(t).padStart(2,"0")}`;A(a)};l.useEffect(()=>{if(o&&M.includes(o)){const t=i.find(a=>!M.includes(a.id));F((t==null?void 0:t.id)||null)}},[M,o,i]);const K=()=>{const t=[];if(S){const m=new Date(r,h,S).toLocaleDateString("en-US",{weekday:"long"}),R=n[h];t.push(`${R} ${S} (${m})`)}if(o){const a=i.find(m=>m.id===o);a&&t.push(a.start_time_formatted)}return t.push(`${w} Guest${w>1?"s":""}`),!S&&!o?"Select date and time":t.join(", ")},P=()=>S&&o&&!M.includes(o)&&N.trim()&&I.trim()&&D.trim()&&E.trim()&&D.includes("@")&&D.includes("."),q=(t,a)=>{/^[a-zA-Z\s]*$/.test(t)&&a(t)},U=t=>{k(t)},X=t=>{/^[\d\s\-\+]*$/.test(t)&&t.length<=12&&z(t)},ee=async()=>{var t;if(!P()){p("Please fill in all required fields correctly.","error");return}B(!0);try{const a={guest_first_name:N.trim(),guest_last_name:I.trim(),guest_email:D.trim(),guest_phone:E.trim(),reservation_date:`${r}-${String(h+1).padStart(2,"0")}-${String(S).padStart(2,"0")}`,time_slot_id:o,guest_count:w},m=await fetch("/staff/api/quick-reservations",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((t=document.querySelector('meta[name="csrf-token"]'))==null?void 0:t.getAttribute("content"))||""},body:JSON.stringify(a)}),R=await m.json();m.ok&&R.success?(p("Reservation created successfully!","success"),s(),f&&f()):p(R.message||"Failed to create reservation.","error")}catch(a){console.error("Reservation error:",a),p("An error occurred while creating the reservation.","error")}finally{B(!1)}},s=()=>{u(new Date().getMonth()),F(i.length>0?i[0].id:null),_(1),T(null),C(""),y(""),k(""),z("63"),Y([]),c([]),B(!1),x()};return d?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-[#3f411a] rounded-4xl shadow-lg max-w-6xl w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl text-beige font-lexend font-bold",children:"Quick Reservation"}),e.jsx("button",{onClick:s,className:"text-beige hover:text-white text-2xl font-bold",children:"Ã—"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsxs("div",{className:"relative w-45",children:[e.jsx("label",{className:"block text-base font-extralight font-lexend mb-2 text-beige",children:"Month"}),e.jsxs(G,{value:h.toString(),onValueChange:t=>{u(parseInt(t)),T(null)},children:[e.jsx(V,{className:"bg-[#f6f5c6] border-[#3f411a] text-[#3f411a] w-full pr-8 py-2 text-base font-extralight font-lexend rounded-xl",children:e.jsx(H,{})}),e.jsx(W,{className:"bg-[#f6f5c6] border-[#3f411a] text-[#3f411a]",children:n.map((t,a)=>e.jsx(Q,{value:a.toString(),className:"bg-[#f6f5c6] font-extralight font-lexend text-[#3f411a] hover:bg-[#e8e6b3] focus:bg-[#e8e6b3]",children:t},t))})]})]}),e.jsxs("div",{className:"relative w-40",children:[e.jsx("label",{className:"block text-base font-extralight font-lexend mb-2 text-beige",children:"Time"}),e.jsxs(G,{value:(o==null?void 0:o.toString())||"",onValueChange:t=>F(parseInt(t)),children:[e.jsx(V,{className:"bg-[#f6f5c6] border-[#3f411a] text-[#3f411a] w-full pr-8 py-2 text-base font-extralight font-lexend rounded-xl",children:e.jsx(H,{})}),e.jsx(W,{className:"bg-[#f6f5c6] border-[#3f411a] text-[#3f411a]",children:i.map(t=>{const a=M.includes(t.id);return e.jsxs(Q,{value:t.id.toString(),className:`bg-[#f6f5c6] font-extralight font-lexend text-[#3f411a] hover:bg-[#e8e6b3] focus:bg-[#e8e6b3] ${a?"text-gray-500":""}`,disabled:a,children:[t.start_time_formatted," ",a?"(Booked)":""]},t.id)})})]})]}),e.jsxs("div",{className:"relative w-30",children:[e.jsx("label",{className:"block text-base font-extralight font-lexend mb-2 text-beige",children:"Guests"}),e.jsxs(G,{value:w.toString(),onValueChange:t=>_(parseInt(t)),children:[e.jsx(V,{className:"bg-[#f6f5c6] border-[#3f411a] text-[#3f411a] w-full pr-8 py-2 text-base font-extralight font-lexend rounded-xl",children:e.jsx(H,{})}),e.jsx(W,{className:"bg-[#f6f5c6] border-[#3f411a] text-[#3f411a]",children:[1,2,3,4,5,6,7,8].map(t=>e.jsx(Q,{value:t.toString(),className:"bg-[#f6f5c6] font-extralight font-lexend text-[#3f411a] hover:bg-[#e8e6b3] focus:bg-[#e8e6b3]",children:t},t))})]})]})]}),e.jsx(ie,{selectedMonth:h,selectedYear:r,selectedDate:S,onDateSelect:Z,isDateDisabled:v,isDateFullyBooked:L,months:n})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-base font-extralight font-lexend mb-3 text-beige",children:"Selected Details"}),e.jsx("div",{className:"border-b border-beige pb-2 text-lg font-extralight font-lexend text-beige",children:K()})]}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-base font-extralight font-lexend mb-2 text-beige",children:"First Name"}),e.jsx("input",{type:"text",value:N,onChange:t=>q(t.target.value,C),className:"w-full bg-[#f6f5c6] border border-[#3f411a] text-[#3f411a] p-3 rounded-xl outline-none text-base font-extralight font-lexend",placeholder:"First name",required:!0})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-base font-extralight font-lexend mb-2 text-beige",children:"Last Name"}),e.jsx("input",{type:"text",value:I,onChange:t=>q(t.target.value,y),className:"w-full bg-[#f6f5c6] border border-[#3f411a] text-[#3f411a] p-3 rounded-xl outline-none text-base font-extralight font-lexend",placeholder:"Last name",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-base font-extralight font-lexend mb-2 text-beige",children:"Email"}),e.jsx("input",{type:"email",value:D,onChange:t=>U(t.target.value),className:"w-full bg-[#f6f5c6] border border-[#3f411a] text-[#3f411a] p-3 rounded-xl outline-none text-base font-extralight font-lexend",placeholder:"Enter email",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-base font-extralight font-lexend mb-2 text-beige",children:"Phone Number"}),e.jsx("div",{className:"relative",children:e.jsxs("div",{className:"flex items-center bg-[#f6f5c6] border border-[#3f411a] p-3 rounded-xl",children:[e.jsx("span",{className:"text-[#3f411a] text-base font-extralight mr-1 select-none",children:"+"}),e.jsx("input",{type:"tel",value:E,onChange:t=>X(t.target.value),className:"flex-1 bg-transparent text-[#3f411a] outline-none text-base font-extralight font-lexend pr-12",placeholder:"63",required:!0}),e.jsxs("span",{className:"text-[#3f411a] text-sm font-extralight font-lexend",children:[E.length,"/12"]})]})})]}),e.jsx("button",{onClick:ee,disabled:!P()||$,className:`block w-full text-center font-extralight font-lexend py-4 mt-8 text-lg transition duration-200 rounded-xl ${P()&&!$?"bg-beige text-[#3f411a] hover:bg-[#e8e6b3] cursor-pointer":"bg-gray-400 text-gray-600 cursor-not-allowed"}`,children:$?"Creating Reservation...":"Create Reservation"})]})]})]})})}):null};function te(d){return d?d.slice(0,10):""}function ne(d){return new Date(d).toISOString().split("T")[0]}function re(d,x){const f=i=>{const g=i.toLowerCase(),[p,h]=g.split(" "),[u,r]=p.split(":").map(Number);let o=u;return h==="pm"&&u!==12?o=u+12:h==="am"&&u===12&&(o=0),o*60+r};return f(d)-f(x)}const me={confirmed:"bg-green-200 text-green-900 border-green-400",completed:"bg-blue-200 text-blue-900 border-blue-400",cancelled:"bg-red-200 text-red-900 border-red-400",all:"bg-yellow-100 text-yellow-900 border-yellow-400"},ge=[{value:"firstName-asc",label:"First Name (A-Z)"},{value:"firstName-desc",label:"First Name (Z-A)"},{value:"lastName-asc",label:"Last Name (A-Z)"},{value:"lastName-desc",label:"Last Name (Z-A)"},{value:"timeSlot-am-pm",label:"Time Slot (Morning-Evening)"},{value:"timeSlot-pm-am",label:"Time Slot (Evening-Morning)"},{value:"guest-asc",label:"Guests (Lowest-Highest)"},{value:"guest-desc",label:"Guests (Highest-Lowest)"},{value:"date-asc",label:"Reservation Date (Earliest-Latest)"},{value:"date-desc",label:"Reservation Date (Latest-Earliest)"}];Array.from({length:31},(d,x)=>(x+1).toString());const be=({status:d,onReservationUpdate:x,endpointPrefix:f,timeSlots:i,systemSettings:g})=>{const{showNotification:p}=oe(),[h,u]=l.useState([]),[r,o]=l.useState(null),[F,w]=l.useState(!1),[_,S]=l.useState(""),[T,N]=l.useState("date-asc"),[C,I]=l.useState(null),[y,D]=l.useState(null),[k,E]=l.useState(null),[z,M]=l.useState(!1),[Y,O]=l.useState(!1),[c,$]=l.useState(null),[B,n]=l.useState(!1),[b,j]=l.useState(!1);ae.useMemo(()=>["All",...Array.from(new Set(h.map(t=>t.reservation_date.slice(0,4)))).sort()],[h]),l.useEffect(()=>{w(!0),fetch(`${f||"/staff"}/api/reservations?status=${d}`).then(s=>s.json()).then(s=>{let t=s.reservations||[];d==="all"&&(t=t.filter(a=>a.status!=="pending")),console.log("Loaded reservations:",t),u(t),w(!1)})},[d,f]);const v=s=>{o(r===s?null:s)};let L=h.filter(s=>{const t=s.guest_first_name.toLowerCase().includes(_.toLowerCase())||s.guest_last_name.toLowerCase().includes(_.toLowerCase())||s.email.toLowerCase().includes(_.toLowerCase())||s.phone.toLowerCase().includes(_.toLowerCase());let a=!0;if(C)a=ne(s.reservation_date)===C;else if(y&&k){const m=new Date(s.reservation_date),R=m.toLocaleString("default",{month:"long"}),J=m.getFullYear();a=R===y&&J===k}return(C||y&&k)&&console.log("Comparing dates:",{selectedDate:C,selectedMonth:y,selectedYear:k,reservationDate:s.reservation_date,normalizedReservationDate:ne(s.reservation_date),reservationMonth:new Date(s.reservation_date).toLocaleString("default",{month:"long"}),reservationYear:new Date(s.reservation_date).getFullYear(),matches:a}),t&&a});L=L.sort((s,t)=>{switch(T){case"firstName-asc":return s.guest_first_name.localeCompare(t.guest_first_name);case"firstName-desc":return t.guest_first_name.localeCompare(s.guest_first_name);case"lastName-asc":return s.guest_last_name.localeCompare(t.guest_last_name);case"lastName-desc":return t.guest_last_name.localeCompare(s.guest_last_name);case"timeSlot-am-pm":return re(s.time_slot||"",t.time_slot||"");case"timeSlot-pm-am":return re(t.time_slot||"",s.time_slot||"");case"guest-asc":return s.guest_count-t.guest_count;case"guest-desc":return t.guest_count-s.guest_count;case"date-asc":return s.reservation_date.localeCompare(t.reservation_date);case"date-desc":return t.reservation_date.localeCompare(s.reservation_date);default:return 0}});const A=(s,t,a)=>{$({type:"complete",reservationId:s,reservationName:`${t} ${a}`}),O(!0)},Z=(s,t,a)=>{$({type:"cancel",reservationId:s,reservationName:`${t} ${a}`}),O(!0)},K=async()=>{var s;if(c){n(!0);try{const t=c.type==="complete"?`${f||"/staff"}/api/reservations/${c.reservationId}/complete`:`${f||"/staff"}/api/reservations/${c.reservationId}/cancel`,m=await(await fetch(t,{method:"PATCH",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((s=document.querySelector('meta[name="csrf-token"]'))==null?void 0:s.getAttribute("content"))||""}})).json();m.success?(u(R=>R.map(J=>J.id===c.reservationId?{...J,status:c.type==="complete"?"completed":"cancelled"}:J)),p(`Reservation ${c.type==="complete"?"completed":"cancelled"} successfully!`,"success"),x&&x()):p(`Failed to ${c.type} reservation: ${m.message}`,"error")}catch(t){console.error("Error executing action:",t),p(`Failed to ${c.type} reservation. Please try again.`,"error")}finally{n(!1),O(!1),$(null)}}},P=()=>{O(!1),$(null)},q=s=>{I(s),D(null),E(null)},U=(s,t)=>{D(s),E(t),I(null)},X=s=>new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),ee=()=>C?X(C):y&&k?`${y} ${k}`:"Date";return e.jsxs("div",{className:"bg-white rounded-4xl shadow-lg p-8",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between mb-6 gap-4",children:[e.jsx("h2",{className:"text-2xl text-[#3f411a] font-lexend font-bold",children:"Reservations"}),e.jsxs("div",{className:"flex flex-wrap gap-2 items-center w-full md:w-auto justify-end",children:[e.jsx("button",{onClick:()=>j(!0),className:"rounded-xl bg-[#f6f5c6] text-[#3f411a] font-lexend border-none px-4 py-2 focus:ring-2 focus:ring-yellow-300 hover:bg-[#e8e6b3] transition-colors",title:"Quick Reservation",children:"+"}),e.jsxs(G,{value:T,onValueChange:N,children:[e.jsx(V,{className:"w-100 rounded-xl bg-[#f6f5c6] text-[#3f411a] font-lexend border-none px-4 py-2 focus:ring-2 focus:ring-yellow-300 hover:bg-[#e8e6b3]",children:e.jsx(H,{})}),e.jsx(W,{className:"w-100 bg-[#f6f5c6] py-2 text-[#3f411a] border-[#f6f5c6]",children:ge.map(s=>e.jsx(Q,{value:s.value,className:"text-[#3f411a] hover:bg-[#e8e6b3] focus:bg-[#e8e6b3]  font-lexend",children:s.label},s.value))})]}),e.jsx("button",{onClick:()=>M(!0),className:"rounded-xl bg-[#f6f5c6] text-[#3f411a] font-lexend border-none px-4 py-2 focus:ring-2 focus:ring-yellow-300 hover:bg-[#e8e6b3] transition-colors",children:ee()}),e.jsx("input",{type:"text",className:"w-68 rounded-xl bg-[#f6f5c6] text-[#3f411a] font-lexend border-none px-4 py-2 focus:ring-2 focus:ring-yellow-300",placeholder:"Search...",value:_,onChange:s=>S(s.target.value)})]})]}),F?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Loading..."}):L.length===0?e.jsx("div",{className:"text-center py-8 font-lexend text-gray-500",children:"No reservations found."}):e.jsxs("table",{className:"w-full text-left font-lexend",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200",children:[e.jsx("th",{className:"py-3 px-3 font-regular",children:"First Name"}),e.jsx("th",{className:"py-3 px-6 font-regular",children:"Last Name"}),e.jsx("th",{className:"py-3 px-3 font-regular",children:"Reservation Date"}),e.jsx("th",{className:"py-3 px-1 text-center font-regular",children:"Time Slot"}),e.jsx("th",{className:"py-3 px-3 text-center font-regular",children:"Guests"}),e.jsx("th",{className:"py-3 px-3 text-center font-regular",children:"Status"}),e.jsx("th",{className:"py-3 px-3 text-center font-regular",children:"Action"})]})}),e.jsx("tbody",{children:L.map(s=>e.jsxs(ae.Fragment,{children:[e.jsxs("tr",{className:`cursor-pointer hover:bg-yellow-50 transition ${r===s.id?"bg-yellow-50":""}`,onClick:()=>v(s.id),children:[e.jsx("td",{className:"py-6 px-3 font-light",children:s.guest_first_name}),e.jsx("td",{className:"py-6 px-6 font-light",children:s.guest_last_name}),e.jsx("td",{className:"py-6 px-3 font-light",children:te(s.reservation_date)}),e.jsx("td",{className:"py-6 px-1 text-center font-light",children:s.time_slot||"-"}),e.jsx("td",{className:"py-6 px-3 text-center font-light",children:s.guest_count}),e.jsx("td",{className:"py-6 px-3 text-center",children:e.jsx("span",{className:`inline-block px-3 py-1 rounded-full border text-xs font-extralight capitalize ${me[s.status]||"bg-gray-200 text-gray-700 border-gray-300"}`,children:s.status})}),e.jsx("td",{className:"py-6 px-3 text-center",children:s.status!=="completed"&&s.status!=="cancelled"&&e.jsxs("div",{className:"flex gap-2 justify-center",children:[e.jsx("button",{className:"bg-blue-200 hover:bg-blue-300 text-blue-900 border-blue-400 border px-3 py-1 rounded text-xs font-extralight",onClick:t=>{t.stopPropagation(),A(s.id,s.guest_first_name,s.guest_last_name)},children:"Complete"}),e.jsx("button",{className:"bg-red-200 hover:bg-red-300 text-red-900 border-red-400 border px-3 py-1 rounded text-xs font-extralight",onClick:t=>{t.stopPropagation(),Z(s.id,s.guest_first_name,s.guest_last_name)},children:"Cancel"})]})})]}),r===s.id&&e.jsx("tr",{className:"bg-yellow-50",children:e.jsx("td",{colSpan:7,className:"py-3 px-3",children:e.jsxs("div",{className:"flex flex-col gap-2 text-sm text-[#3f411a] font-light",children:[e.jsxs("div",{children:[e.jsx("b",{children:"Email:"})," ",s.email]}),e.jsxs("div",{children:[e.jsx("b",{children:"Phone:"})," ",s.phone]}),e.jsxs("div",{children:[e.jsx("b",{children:"Created At:"})," ",te(s.created_at)]}),e.jsxs("div",{children:[e.jsx("b",{children:"Updated At:"})," ",te(s.updated_at)]})]})})})]},s.id))})]}),e.jsx(ue,{isOpen:z,onClose:()=>M(!1),onDateSelect:q,onMonthSelect:U,selectedDate:C,selectedMonth:y,selectedYear:k}),e.jsx(fe,{isOpen:Y,onClose:P,onConfirm:K,title:(c==null?void 0:c.type)==="complete"?"Complete Reservation":"Cancel Reservation",message:`Are you sure you want to ${c==null?void 0:c.type} the reservation for ${c==null?void 0:c.reservationName}?`,type:(c==null?void 0:c.type)||"complete"}),i&&g&&e.jsx(he,{isOpen:b,onClose:()=>j(!1),onReservationCreated:()=>{w(!0),fetch(`${f||"/staff"}/api/reservations?status=${d}`).then(s=>s.json()).then(s=>{let t=s.reservations||[];d==="all"&&(t=t.filter(a=>a.status!=="pending")),u(t),w(!1)}),x&&x()},timeSlots:i,systemSettings:g})]})},pe=[{label:"Confirmed Reservation",color:"bg-green-200 hover:bg-green-300 text-green-900 border-green-400",activeColor:"bg-green-300 text-green-900 border-green-500 ring-4 ring-green-300",status:"confirmed"},{label:"Completed Reservation",color:"bg-blue-200 hover:bg-blue-300 text-blue-900 border-blue-400",activeColor:"bg-blue-300 text-blue-900 border-blue-500 ring-4 ring-blue-300",status:"completed"},{label:"Cancelled Reservation",color:"bg-red-200 hover:bg-red-300 text-red-900 border-red-400",activeColor:"bg-red-300 text-red-900 border-red-500 ring-4 ring-red-300",status:"cancelled"},{label:"All Reservation",color:"bg-yellow-100 hover:bg-yellow-200 text-yellow-900 border-yellow-400",activeColor:"bg-yellow-200 text-yellow-900 border-yellow-500 ring-4 ring-yellow-300",status:"all"}],we=()=>{const{timeSlots:d,systemSettings:x}=le().props,[f,i]=l.useState({confirmed:0,completed:0,cancelled:0,all:0}),[g,p]=l.useState("all"),h=()=>{fetch("/staff/api/reservation-counts").then(r=>r.json()).then(r=>{i({confirmed:r.confirmed||0,completed:r.completed||0,cancelled:r.cancelled||0,all:r.all||0})}).catch(r=>{console.error("Error fetching counts:",r)})};l.useEffect(()=>{h()},[]);const u=()=>{h()};return e.jsxs(xe,{children:[e.jsx("p",{className:"text-olive text-4xl font-bold px-12 py-10 font-lexend",children:"BOOKING"}),e.jsx("div",{className:"px-12 flex gap-6 mb-8",children:pe.map(r=>e.jsx("button",{className:`flex-1 rounded-2xl shadow border-2 p-8 font-lexend font-light text-xl transition-all duration-200 cursor-pointer ${g===r.status?r.activeColor:r.color}`,onClick:()=>p(r.status),children:e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx("span",{children:r.label}),e.jsx("span",{className:"mt-4 text-4xl font-bold tracking-wide",children:f[r.status]})]})},r.label))}),e.jsx("div",{className:"px-12",children:e.jsx(be,{status:g,onReservationUpdate:u,endpointPrefix:"/staff",timeSlots:d,systemSettings:x})})]})};export{we as default};
