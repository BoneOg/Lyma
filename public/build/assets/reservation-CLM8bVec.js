import{j as e,r as l,S as be,J as ge,u as pe}from"./app-BNrObbxa.js";import{L as we}from"./layout-C86ujSG8.js";import{S as K,a as W,b as Z,c as Q,d as I,C as Ne}from"./Calendar-D63QnPvQ.js";import"./utils-WuXrF6sg.js";import"./check-D9ugfRA5.js";const je=({firstName:u,lastName:j,email:g,phone:x,specialRequests:_,onFirstNameChange:o,onLastNameChange:B,onEmailChange:n,onPhoneChange:p,onSpecialRequestsChange:w,formatSelectedDateTime:$})=>{const h=(r,v)=>{/^[a-zA-Z\s]*$/.test(r)&&v(r)},S=r=>{n(r)},k=r=>{/^[\d\s\-\+]*$/.test(r)&&r.length<=15&&p(r)};return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-base font-extralight font-lexend mb-3",children:"When"}),e.jsx("div",{className:"border-b border-white pb-2 text-lg font-extralight font-lexend",children:$()})]}),e.jsxs("div",{className:"flex space-x-6",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-base font-extralight font-lexend mb-2",children:"First Name"}),e.jsx("input",{type:"text",value:u,onChange:r=>h(r.target.value,o),className:"w-full bg-transparent border-b border-white text-white pb-2 outline-none text-base font-extralight font-lexend",placeholder:"First name",required:!0})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-base font-extralight font-lexend mb-2",children:"Last Name"}),e.jsx("input",{type:"text",value:j,onChange:r=>h(r.target.value,B),className:"w-full bg-transparent border-b border-white text-white pb-2 outline-none text-base font-extralight font-lexend",placeholder:"Last name",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-base font-extralight font-lexend mb-2",children:"Email"}),e.jsx("input",{type:"email",value:g,onChange:r=>S(r.target.value),className:"w-full bg-transparent border-b border-white text-white pb-2 outline-none text-base font-extralight font-lexend",placeholder:"Enter your email",required:!0})]}),e.jsxs("div",{className:"flex space-x-6",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-base font-extralight font-lexend mb-2",children:"Phone Number"}),e.jsx("input",{type:"tel",value:x,onChange:r=>k(r.target.value),className:"w-full bg-transparent border-b border-white text-white pb-2 outline-none text-base font-extralight font-lexend",placeholder:"+1 234 567 8901",required:!0})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-base font-extralight font-lexend mb-2",children:"Special Requests"}),e.jsx("input",{type:"text",value:_,onChange:r=>w(r.target.value),className:"w-full bg-transparent border-b border-white text-white pb-2 outline-none text-base font-extralight font-lexend",placeholder:"ex. Food Allergies"})]})]})]})},Se=({timeSlots:u,systemSettings:j,errors:g})=>{const[x,_]=l.useState(new Date().getMonth()),[o,B]=l.useState(new Date().getFullYear()),[n,p]=l.useState(u.length>0?u[0].id:null),[w,$]=l.useState(j.min_guest_size||1),[h,S]=l.useState(null),[k,r]=l.useState(""),[v,y]=l.useState(""),[D,X]=l.useState(""),[F,ee]=l.useState(""),[E,te]=l.useState(""),[C,Y]=l.useState([]),[N,A]=l.useState([]),[O,L]=l.useState([]),[R,P]=l.useState([]),[M,V]=l.useState({}),[se,H]=l.useState(!1),[G,q]=l.useState(!1),[ae,ne]=l.useState(new Set),[le,J]=l.useState(new Map),s=["January","February","March","April","May","June","July","August","September","October","November","December"],c=[new Date().getFullYear(),new Date().getFullYear()+1,new Date().getFullYear()+2];l.useEffect(()=>{const t=localStorage.getItem("disabledDates"),a=localStorage.getItem("disabledTimeSlots");if(t&&ne(new Set(JSON.parse(t))),a){const i=JSON.parse(a),m=new Map;Object.keys(i).forEach(U=>{m.set(U,new Set(i[U]))}),J(m)}},[]),l.useEffect(()=>{T(),z(),b()},[x,o]);const f=new Date,d=new Date(f.getTime()+j.max_advance_booking_days*24*60*60*1e3),T=async()=>{try{const a=await(await fetch(`/reservations/fully-booked-dates?month=${x+1}&year=${o}`)).json();L(a.fully_booked_dates||[])}catch(t){console.error("Error fetching fully booked dates:",t),L([])}},z=async()=>{try{const a=await(await fetch(`/reservations/closed-dates?month=${x+1}&year=${o}`)).json();P(a.closed_dates||[])}catch(t){console.error("Error fetching closed dates:",t),P([])}},b=async()=>{try{const a=await(await fetch(`/reservations/special-hours-dates?month=${x+1}&year=${o}`)).json(),i={};a.special_hours_data&&a.special_hours_data.forEach(m=>{i[m.day]={special_start:m.special_start,special_end:m.special_end}}),V(i)}catch(t){console.error("Error fetching special hours dates:",t),V({})}},ce=t=>{const a=new Date(o,x,t);a.setHours(0,0,0,0);const i=new Date;if(i.setHours(0,0,0,0),a<=i||a>d)return!0;const U=`${s[x]}-${t}`;return!!(ae.has(U)||R.includes(t))},de=t=>O.includes(t),xe=t=>R.includes(t),re=t=>M.hasOwnProperty(t),oe=t=>M[t]||null,he=t=>N.includes(t),ue=async t=>{try{const i=await(await fetch(`/reservations/occupied-time-slots?date=${t}`)).json();Y(i.occupied_time_slots||[]),A(i.disabled_time_slots||[])}catch(a){console.error("Error fetching occupied time slots:",a),Y([]),A([])}},fe=t=>{S(t);const a=`${o}-${String(x+1).padStart(2,"0")}-${String(t).padStart(2,"0")}`;if(ue(a),re(t))p("special-hours");else{const i=u.find(m=>!C.includes(m.id)&&!N.includes(m.id));p((i==null?void 0:i.id)||null)}};l.useEffect(()=>{if(n&&typeof n=="number"&&(C.includes(n)||N.includes(n))){const t=u.find(a=>!C.includes(a.id)&&!N.includes(a.id));p((t==null?void 0:t.id)||null)}},[C,N,n,u]);const me=()=>{const t=[];if(h){const i=new Date(o,x,h).toLocaleDateString("en-US",{weekday:"long"}),m=s[x];t.push(`${m} ${h} (${i})`)}if(n)if(n==="special-hours"){const a=oe(h);a&&t.push(`${a.special_start} - ${a.special_end} (Special Hours)`)}else{const a=u.find(i=>i.id===n);a&&t.push(a.start_time_formatted)}return t.push(`${w} Guest${w>1?"s":""}`),!h&&!n?"Select date and time":t.join(", ")},ie=()=>h&&n&&(n==="special-hours"||!C.includes(n)&&!N.includes(n))&&k.trim()&&v.trim()&&D.trim()&&F.trim()&&D.includes("@")&&D.includes(".");return{selectedMonth:x,selectedYear:o,selectedTimeSlot:n,guestCount:w,selectedDate:h,firstName:k,lastName:v,email:D,phone:F,specialRequests:E,occupiedTimeSlots:C,disabledTimeSlots:N,fullyBookedDates:O,closedDates:R,specialHoursData:M,showConfirmationModal:se,isBooking:G,months:s,years:c,setSelectedMonth:_,setSelectedYear:B,setSelectedTimeSlot:p,setGuestCount:$,setSelectedDate:S,setFirstName:r,setLastName:y,setEmail:X,setPhone:ee,setSpecialRequests:te,isDateDisabled:ce,isDateFullyBooked:de,isDateClosed:xe,isDateSpecialHours:re,getSpecialHoursForDate:oe,isTimeSlotAdminDisabled:he,handleDateSelect:fe,formatSelectedDateTime:me,isFormValid:ie,handleBookTable:()=>{H(!0)},handleConfirmBooking:async()=>{if(ie()){q(!0);try{const t={guest_first_name:k.trim(),guest_last_name:v.trim(),guest_email:D.trim(),guest_phone:F.trim(),special_requests:E.trim(),reservation_date:`${o}-${String(x+1).padStart(2,"0")}-${String(h).padStart(2,"0")}`,time_slot_id:n==="special-hours"?null:n,guest_count:w,is_special_hours:n==="special-hours"};be.post("/reservations",t),H(!1)}catch(t){console.error("Booking error:",t)}finally{q(!1)}}},handleCancelBooking:()=>{H(!1)},timeSlots:u,errors:g}};function Be(){const{timeSlots:u,systemSettings:j,errors:g}=ge().props,{selectedMonth:x,selectedYear:_,selectedTimeSlot:o,guestCount:B,selectedDate:n,firstName:p,lastName:w,email:$,phone:h,specialRequests:S,occupiedTimeSlots:k,disabledTimeSlots:r,showConfirmationModal:v,isBooking:y,months:D,years:X,setSelectedMonth:F,setSelectedYear:ee,setSelectedTimeSlot:E,setGuestCount:te,setSelectedDate:C,setFirstName:Y,setLastName:N,setEmail:A,setPhone:O,setSpecialRequests:L,isDateDisabled:R,isDateFullyBooked:P,isDateClosed:M,isDateSpecialHours:V,getSpecialHoursForDate:se,handleDateSelect:H,formatSelectedDateTime:G,isFormValid:q,handleBookTable:ae,handleConfirmBooking:ne,handleCancelBooking:le}=Se({timeSlots:u,systemSettings:j,errors:g}),{showNotification:J}=pe();return l.useEffect(()=>{if(typeof window<"u"){const s=new URLSearchParams(window.location.search);if(s.get("expired")==="1"){J("Your reservation has expired. Please try booking again.","warning"),s.delete("expired");const c=window.location.pathname+(s.toString()?"?"+s.toString():"");window.history.replaceState({},"",c)}}},[J]),e.jsxs(we,{children:[e.jsx("div",{className:"min-h-screen bg-[#3f411a] flex justify-center text-white px-4 pt-10",children:e.jsxs("div",{className:"max-w-5xl w-full py-12 mt-20",children:[e.jsx("h1",{className:"text-6xl font-extralight font-lexend text-beige mb-12",children:"RESERVATION"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8 items-start",children:[e.jsx("div",{className:"flex flex-col justify-start h-full",children:e.jsxs("div",{className:"flex flex-col justify-start h-full",children:[e.jsxs("div",{className:"flex space-x-4 mb-10",children:[e.jsxs("div",{className:"relative w-40",children:[e.jsx("label",{className:"block text-base font-extralight font-lexend mb-2",children:"Month"}),e.jsxs(K,{value:x.toString(),onValueChange:s=>{F(parseInt(s)),C(null)},children:[e.jsx(W,{className:"bg-transparent border-b border-white text-white w-full pr-8 py-2 text-base font-extralight font-lexend rounded-none border-t-0 border-l-0 border-r-0 focus:ring-0 focus:ring-offset-0 px-0 h-auto",children:e.jsx(Z,{})}),e.jsx(Q,{className:"bg-[#3f411a] border-white text-white max-h-none overflow-y-visible",children:D.map((s,c)=>e.jsx(I,{value:c.toString(),className:"bg-[#3f411a] font-extralight font-lexend text-white hover:bg-[#5a5d2a] focus:bg-[#5a5d2a]",children:s},s))})]})]}),e.jsxs("div",{className:"relative w-28",children:[e.jsx("label",{className:"block text-base font-extralight font-lexend mb-2",children:"Year"}),e.jsxs(K,{value:_.toString(),onValueChange:s=>ee(parseInt(s)),children:[e.jsx(W,{className:"bg-transparent border-b border-white text-white w-full pr-8 py-2 text-base font-extralight font-lexend rounded-none border-t-0 border-l-0 border-r-0 focus:ring-0 focus:ring-offset-0 px-0 h-auto",children:e.jsx(Z,{})}),e.jsx(Q,{className:"bg-[#3f411a] border-white text-white",children:X.map(s=>e.jsx(I,{value:s.toString(),className:"bg-[#3f411a] font-extralight font-lexend text-white hover:bg-[#5a5d2a] focus:bg-[#5a5d2a]",children:s},s))})]})]}),e.jsxs("div",{className:"relative w-40",children:[e.jsx("label",{className:"block text-base font-extralight font-lexend mb-2",children:"Time"}),e.jsxs(K,{value:(o==null?void 0:o.toString())||"",onValueChange:s=>{E(s==="special-hours"?"special-hours":parseInt(s))},children:[e.jsx(W,{className:`bg-transparent border-b border-white text-white w-full font-extralight font-lexend rounded-none border-t-0 border-l-0 border-r-0 focus:ring-0 focus:ring-offset-0 px-0 h-auto text-left ${o==="special-hours"?"py-3 text-xs":"py-2 text-base"}`,children:e.jsx(Z,{children:(()=>{if(o==="special-hours")return"Special Hours";if(o&&typeof o=="number"){const s=u.find(c=>c.id===o);return s?s.start_time_formatted:""}return""})()})}),e.jsx(Q,{className:"bg-[#3f411a] border-white text-white",children:(()=>{const s=n?se(n):null;return s?e.jsxs(I,{value:"special-hours",className:"bg-[#3f411a] font-extralight font-lexend text-white hover:bg-[#5a5d2a] focus:bg-[#5a5d2a]",children:[s.special_start," - ",s.special_end," (Special Hours)"]}):u.map(c=>{const f=k.includes(c.id),d=r.includes(c.id),T=f||d;return e.jsxs(I,{value:c.id.toString(),className:`bg-[#3f411a] font-extralight font-lexend focus:bg-[#5a5d2a] relative ${T?"cursor-not-allowed":"hover:bg-[#5a5d2a]"} ${f?"!opacity-100":""} ${d?"!opacity-100":""}`,disabled:T,children:[e.jsx("span",{className:f?"text-[#D4847C]":d?"text-[#5295bb]":"text-white",children:c.start_time_formatted}),f&&e.jsx("div",{className:"absolute right-2 top-1/2 transform -translate-y-1/2 w-2 h-2 bg-[#D4847C] rounded-full opacity-100"}),d&&!f&&e.jsx("div",{className:"absolute right-2 top-1/2 transform -translate-y-1/2 w-2 h-2 bg-[#5295bb] rounded-full opacity-100"})]},c.id)})})()})]})]}),e.jsxs("div",{className:"relative w-24",children:[e.jsx("label",{className:"block text-base font-extralight font-lexend mb-2",children:"Guests"}),e.jsxs(K,{value:B.toString(),onValueChange:s=>te(parseInt(s)),children:[e.jsx(W,{className:"bg-transparent border-b border-white text-white w-full pr-8 py-2 text-base font-extralight font-lexend rounded-none border-t-0 border-l-0 border-r-0 focus:ring-0 focus:ring-offset-0 px-0 h-auto",children:e.jsx(Z,{})}),e.jsx(Q,{className:"bg-[#3f411a] border-white text-white",children:(()=>{const s=j.min_guest_size||1,c=j.max_guest_size||10,f=[];for(let d=s;d<=c;d++)f.push(d);return f.map(d=>e.jsx(I,{value:d.toString(),className:"bg-[#3f411a] font-extralight font-lexend text-white hover:bg-[#5a5d2a] focus:bg-[#5a5d2a]",children:d},d))})()})]})]})]}),e.jsx(Ne,{selectedMonth:x,selectedYear:_,selectedDate:n,onDateSelect:H,isDateDisabled:R,isDateFullyBooked:P,isDateClosed:M,isDateSpecialHours:V,months:D,className:"grid grid-cols-7 text-center gap-y-7 text-white text-lg",dayClassName:(s,{isDisabled:c,isFullyBooked:f,isSelected:d,isClosed:T,isSpecialHours:z})=>{let b="transition-colors w-8 h-8 flex items-center justify-center font-lexend font-extralight relative";return T?b+=" text-[#5295bb] cursor-not-allowed":f?b+=" text-[#D4847C] cursor-not-allowed":d&&z?b+=" bg-[#f6f5c6] text-[#C5A572] font-semibold  rounded-full cursor-pointer":d?b+=" bg-[#f6f5c6] text-[#3f411a] font-semibold rounded-full cursor-pointer":z?b+=" text-[#C5A572] hover:text-beige-dark cursor-pointer":c?b+=" text-gray-400 cursor-not-allowed":b+=" text-white hover:text-beige-dark cursor-pointer",b}}),e.jsxs("div",{className:"flex justify-center items-center space-x-6 mt-6",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-[#D4847C]"}),e.jsx("span",{className:"text-white font-extralight font-lexend text-sm",children:"Fully Booked"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-[#C5A572]"}),e.jsx("span",{className:"text-white font-extralight font-lexend text-sm",children:"Special Hours"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-[#5295bb]"}),e.jsx("span",{className:"text-white font-extralight font-lexend text-sm",children:"Closed"})]})]})]})}),e.jsxs("div",{className:"flex flex-col justify-between h-full self-stretch w-full max-w-md ml-auto",children:[e.jsx(je,{firstName:p,lastName:w,email:$,phone:h,specialRequests:S,onFirstNameChange:Y,onLastNameChange:N,onEmailChange:A,onPhoneChange:O,onSpecialRequestsChange:L,formatSelectedDateTime:G}),e.jsx("button",{onClick:ae,disabled:!q(),className:`block w-full text-center font-extralight font-lexend py-4 mt-8 text-lg transition duration-200 ${q()?"bg-white text-[#3f411a] hover:bg-[#f6f5c6] cursor-pointer":"bg-gray-400 text-gray-600 cursor-not-allowed"}`,children:"Book a Table"}),(g==null?void 0:g.general)&&e.jsx("div",{className:"mt-6 p-4 bg-red-500 text-white rounded text-base font-extralight font-lexend",children:g.general})]})]})]})}),v&&e.jsx("div",{className:"fixed inset-0 bg-black/20 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-[#3f411a] border-2 border-white p-8 max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-2xl font-extralight font-lexend text-white mb-4",children:"Confirm Reservation"}),e.jsx("p",{className:"text-white mb-6 font-extralight font-lexend",children:"Ready to book your table? Please confirm your details before proceeding."}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{className:"border-b border-white pb-2",children:[e.jsx("span",{className:"text-[#f6f5c6] text-sm font-extralight font-lexend",children:"Date & Time:"}),e.jsx("p",{className:"text-white font-extralight font-lexend",children:G()})]}),e.jsxs("div",{className:"border-b border-white pb-2",children:[e.jsx("span",{className:"text-[#f6f5c6] text-sm font-extralight font-lexend",children:"Guest:"}),e.jsxs("p",{className:"text-white font-extralight font-lexend",children:[p," ",w]})]}),e.jsxs("div",{className:"border-b border-white pb-2",children:[e.jsx("span",{className:"text-[#f6f5c6] text-sm font-extralight font-lexend",children:"Contact:"}),e.jsx("p",{className:"text-white font-extralight font-lexend",children:$}),e.jsx("p",{className:"text-white font-extralight font-lexend",children:h})]}),S&&e.jsxs("div",{className:"border-b border-white pb-2",children:[e.jsx("span",{className:"text-[#f6f5c6] text-sm font-extralight font-lexend",children:"Special Requests:"}),e.jsx("p",{className:"text-white font-extralight font-lexend",children:S})]})]}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx("button",{onClick:ne,disabled:y,className:`flex-1 py-3 font-extralight font-lexend transition duration-200 ${y?"bg-gray-400 text-gray-600 cursor-not-allowed":"bg-white text-[#3f411a] hover:bg-[#f6f5c6]"}`,children:y?"Booking...":"Yes, Book Now"}),e.jsx("button",{onClick:le,disabled:y,className:`flex-1 border border-white py-3 font-extralight font-lexend transition duration-200 ${y?"bg-transparent text-gray-400 cursor-not-allowed":"bg-transparent text-white hover:bg-white hover:text-[#3f411a]"}`,children:"No, Cancel"})]})]})})]})}export{Be as default};
