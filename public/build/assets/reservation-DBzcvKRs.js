import{j as e,r as l,S as ne,J as le,u as re}from"./app-ObBU9MiU.js";import{L as oe}from"./layout-HplSP8KB.js";import{S as A,a as O,b as P,c as V,d as J}from"./select-BxZ7D0AG.js";import{C as ie}from"./Calendar-DtxMdxoJ.js";import"./utils-rh84FEAU.js";const de=({firstName:x,lastName:k,email:f,phone:r,onFirstNameChange:S,onLastNameChange:d,onEmailChange:C,onPhoneChange:o,formatSelectedDateTime:p})=>{const h=(a,m)=>{/^[a-zA-Z\s]*$/.test(a)&&m(a)},v=a=>{C(a)},i=a=>{/^[\d\s\-\+]*$/.test(a)&&a.length<=12&&o(a)};return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-base font-extralight font-lexend mb-3",children:"When"}),e.jsx("div",{className:"border-b border-white pb-2 text-lg font-extralight font-lexend",children:p()})]}),e.jsxs("div",{className:"flex space-x-6",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-base font-extralight font-lexend mb-2",children:"First Name"}),e.jsx("input",{type:"text",value:x,onChange:a=>h(a.target.value,S),className:"w-full bg-transparent border-b border-white text-white pb-2 outline-none text-base font-extralight font-lexend",placeholder:"First name",required:!0})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-base font-extralight font-lexend mb-2",children:"Last Name"}),e.jsx("input",{type:"text",value:k,onChange:a=>h(a.target.value,d),className:"w-full bg-transparent border-b border-white text-white pb-2 outline-none text-base font-extralight font-lexend",placeholder:"Last name",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-base font-extralight font-lexend mb-2",children:"Email"}),e.jsx("input",{type:"email",value:f,onChange:a=>v(a.target.value),className:"w-full bg-transparent border-b border-white text-white pb-2 outline-none text-base font-extralight font-lexend",placeholder:"Enter your email",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-base font-extralight font-lexend mb-2",children:"Phone Number"}),e.jsx("div",{className:"relative",children:e.jsxs("div",{className:"flex items-center bg-transparent border-b border-white pb-2",children:[e.jsx("span",{className:"text-white text-base font-extralight mr-1 select-none",children:"+"}),e.jsx("input",{type:"tel",value:r,onChange:a=>i(a.target.value),className:"flex-1 bg-transparent text-white outline-none text-base font-extralight font-lexend pr-12",placeholder:"63",required:!0}),e.jsxs("span",{className:"text-[#f6f5c6] text-sm font-extralight font-lexend",children:[r.length,"/12"]})]})})]})]})},ce=({timeSlots:x,systemSettings:k,errors:f})=>{const[r,S]=l.useState(new Date().getMonth()),[d,C]=l.useState(new Date().getFullYear()),[o,p]=l.useState(x.length>0?x[0].id:null),[h,v]=l.useState(1),[i,a]=l.useState(null),[m,b]=l.useState(""),[y,G]=l.useState(""),[w,q]=l.useState(""),[T,U]=l.useState("63"),[N,_]=l.useState([]),[B,F]=l.useState([]),[z,$]=l.useState(!1),[H,E]=l.useState(!1),[K,M]=l.useState(new Set),[R,W]=l.useState(new Map),D=["January","February","March","April","May","June","July","August","September","October","November","December"],Z=[new Date().getFullYear(),new Date().getFullYear()+1,new Date().getFullYear()+2];l.useEffect(()=>{const s=localStorage.getItem("disabledDates"),n=localStorage.getItem("disabledTimeSlots");if(s&&M(new Set(JSON.parse(s))),n){const c=JSON.parse(n),g=new Map;Object.keys(c).forEach(j=>{g.set(j,new Set(c[j]))}),W(g)}},[]),l.useEffect(()=>{u()},[r,d]);const I=new Date,t=new Date(I.getTime()+k.max_advance_booking_days*24*60*60*1e3),u=async()=>{try{const n=await(await fetch(`/reservations/fully-booked-dates?month=${r+1}&year=${d}`)).json();F(n.fully_booked_dates||[])}catch(s){console.error("Error fetching fully booked dates:",s),F([])}},Y=s=>{const n=new Date(d,r,s);n.setHours(0,0,0,0);const c=new Date;if(c.setHours(0,0,0,0),n<=c||n>t)return!0;const j=`${D[r]}-${s}`;return!!K.has(j)},L=s=>B.includes(s),X=s=>{if(!i)return!1;const c=`${D[r]}-${i}`,g=R.get(c);if(g){const j=x.find(ae=>ae.id===s);if(j)return g.has(j.start_time_formatted)}return!1},ee=async s=>{try{const c=await(await fetch(`/reservations/occupied-time-slots?date=${s}`)).json();_(c.occupied_time_slots||[])}catch(n){console.error("Error fetching occupied time slots:",n),_([])}},te=s=>{a(s);const n=`${d}-${String(r+1).padStart(2,"0")}-${String(s).padStart(2,"0")}`;ee(n)};l.useEffect(()=>{if(o&&N.includes(o)){const s=x.find(n=>!N.includes(n.id));p((s==null?void 0:s.id)||null)}},[N,o,x]);const se=()=>{const s=[];if(i){const c=new Date(d,r,i).toLocaleDateString("en-US",{weekday:"long"}),g=D[r];s.push(`${g} ${i} (${c})`)}if(o){const n=x.find(c=>c.id===o);n&&s.push(n.start_time_formatted)}return s.push(`${h} Guest${h>1?"s":""}`),!i&&!o?"Select date and time":s.join(", ")},Q=()=>i&&o&&!N.includes(o)&&m.trim()&&y.trim()&&w.trim()&&T.trim()&&w.includes("@")&&w.includes(".");return{selectedMonth:r,selectedYear:d,selectedTimeSlot:o,guestCount:h,selectedDate:i,firstName:m,lastName:y,email:w,phone:T,occupiedTimeSlots:N,fullyBookedDates:B,showConfirmationModal:z,isBooking:H,months:D,years:Z,setSelectedMonth:S,setSelectedYear:C,setSelectedTimeSlot:p,setGuestCount:v,setSelectedDate:a,setFirstName:b,setLastName:G,setEmail:q,setPhone:U,isDateDisabled:Y,isDateFullyBooked:L,isTimeSlotAdminDisabled:X,handleDateSelect:te,formatSelectedDateTime:se,isFormValid:Q,handleBookTable:()=>{$(!0)},handleConfirmBooking:async()=>{if(Q()){E(!0);try{const s={guest_first_name:m.trim(),guest_last_name:y.trim(),guest_email:w.trim(),guest_phone:T.trim(),reservation_date:`${d}-${String(r+1).padStart(2,"0")}-${String(i).padStart(2,"0")}`,time_slot_id:o,guest_count:h};ne.post("/reservations",s),$(!1)}catch(s){console.error("Booking error:",s)}finally{E(!1)}}},handleCancelBooking:()=>{$(!1)},timeSlots:x,errors:f}};function we(){const{timeSlots:x,systemSettings:k,errors:f}=le().props,{selectedMonth:r,selectedYear:S,selectedTimeSlot:d,guestCount:C,selectedDate:o,firstName:p,lastName:h,email:v,phone:i,occupiedTimeSlots:a,showConfirmationModal:m,isBooking:b,months:y,years:G,setSelectedMonth:w,setSelectedYear:q,setSelectedTimeSlot:T,setGuestCount:U,setSelectedDate:N,setFirstName:_,setLastName:B,setEmail:F,setPhone:z,isDateDisabled:$,isDateFullyBooked:H,isTimeSlotAdminDisabled:E,handleDateSelect:K,formatSelectedDateTime:M,isFormValid:R,handleBookTable:W,handleConfirmBooking:D,handleCancelBooking:Z}=ce({timeSlots:x,systemSettings:k,errors:f}),{showNotification:I}=re();return l.useEffect(()=>{if(typeof window<"u"){const t=new URLSearchParams(window.location.search);if(t.get("expired")==="1"){I("Your reservation has expired. Please try booking again.","warning"),t.delete("expired");const u=window.location.pathname+(t.toString()?"?"+t.toString():"");window.history.replaceState({},"",u)}}},[I]),e.jsxs(oe,{children:[e.jsx("div",{className:"min-h-screen bg-[#3f411a] flex justify-center text-white px-4 pt-10",children:e.jsxs("div",{className:"max-w-5xl w-full py-12",children:[e.jsx("h1",{className:"text-6xl font-extralight font-lexend text-beige mb-12",children:"RESERVATION"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8 items-start",children:[e.jsx("div",{className:"flex flex-col justify-start h-full",children:e.jsxs("div",{className:"flex flex-col justify-start h-full",children:[e.jsxs("div",{className:"flex space-x-4 mb-10",children:[e.jsxs("div",{className:"relative w-40",children:[e.jsx("label",{className:"block text-base font-extralight font-lexend mb-2",children:"Month"}),e.jsxs(A,{value:r.toString(),onValueChange:t=>{w(parseInt(t)),N(null)},children:[e.jsx(O,{className:"bg-transparent border-b border-white text-white w-full pr-8 py-2 text-base font-extralight font-lexend rounded-none border-t-0 border-l-0 border-r-0 focus:ring-0 focus:ring-offset-0 px-0 h-auto",children:e.jsx(P,{})}),e.jsx(V,{className:"bg-[#3f411a] border-white text-white",children:y.map((t,u)=>e.jsx(J,{value:u.toString(),className:"bg-[#3f411a] font-extralight font-lexend text-white hover:bg-[#5a5d2a] focus:bg-[#5a5d2a]",children:t},t))})]})]}),e.jsxs("div",{className:"relative w-28",children:[e.jsx("label",{className:"block text-base font-extralight font-lexend mb-2",children:"Year"}),e.jsxs(A,{value:S.toString(),onValueChange:t=>q(parseInt(t)),children:[e.jsx(O,{className:"bg-transparent border-b border-white text-white w-full pr-8 py-2 text-base font-extralight font-lexend rounded-none border-t-0 border-l-0 border-r-0 focus:ring-0 focus:ring-offset-0 px-0 h-auto",children:e.jsx(P,{})}),e.jsx(V,{className:"bg-[#3f411a] border-white text-white",children:G.map(t=>e.jsx(J,{value:t.toString(),className:"bg-[#3f411a] font-extralight font-lexend text-white hover:bg-[#5a5d2a] focus:bg-[#5a5d2a]",children:t},t))})]})]}),e.jsxs("div",{className:"relative w-36",children:[e.jsx("label",{className:"block text-base font-extralight font-lexend mb-2",children:"Time"}),e.jsxs(A,{value:(d==null?void 0:d.toString())||"",onValueChange:t=>T(parseInt(t)),children:[e.jsx(O,{className:"bg-transparent border-b border-white text-white w-full pr-8 py-2 text-base font-extralight font-lexend rounded-none border-t-0 border-l-0 border-r-0 focus:ring-0 focus:ring-offset-0 px-0 h-auto",children:e.jsx(P,{})}),e.jsx(V,{className:"bg-[#3f411a] border-white text-white",children:x.map(t=>{const u=a.includes(t.id),Y=E(t.id),L=u||Y;return e.jsxs(J,{value:t.id.toString(),className:`bg-[#3f411a] font-extralight font-lexend text-white hover:bg-[#5a5d2a] focus:bg-[#5a5d2a] ${L?"text-gray-100":""}`,disabled:L,children:[t.start_time_formatted," ",u?"(Fully Booked)":Y?"(Unavailable)":""]},t.id)})})]})]}),e.jsxs("div",{className:"relative w-24",children:[e.jsx("label",{className:"block text-base font-extralight font-lexend mb-2",children:"Guests"}),e.jsxs(A,{value:C.toString(),onValueChange:t=>U(parseInt(t)),children:[e.jsx(O,{className:"bg-transparent border-b border-white text-white w-full pr-8 py-2 text-base font-extralight font-lexend rounded-none border-t-0 border-l-0 border-r-0 focus:ring-0 focus:ring-offset-0 px-0 h-auto",children:e.jsx(P,{})}),e.jsx(V,{className:"bg-[#3f411a] border-white text-white",children:[1,2,3,4,5,6,7,8].map(t=>e.jsx(J,{value:t.toString(),className:"bg-[#3f411a] font-extralight font-lexend text-white hover:bg-[#5a5d2a] focus:bg-[#5a5d2a]",children:t},t))})]})]})]}),e.jsx(ie,{selectedMonth:r,selectedYear:S,selectedDate:o,onDateSelect:K,isDateDisabled:$,isDateFullyBooked:H,months:y})]})}),e.jsxs("div",{className:"flex flex-col justify-between h-full self-stretch w-full max-w-md ml-auto",children:[e.jsx(de,{firstName:p,lastName:h,email:v,phone:i,onFirstNameChange:_,onLastNameChange:B,onEmailChange:F,onPhoneChange:z,formatSelectedDateTime:M}),e.jsx("button",{onClick:W,disabled:!R(),className:`block w-full text-center font-extralight font-lexend py-4 mt-8 text-lg transition duration-200 ${R()?"bg-white text-[#3f411a] hover:bg-[#f6f5c6] cursor-pointer":"bg-gray-400 text-gray-600 cursor-not-allowed"}`,children:"Book a Table"}),(f==null?void 0:f.general)&&e.jsx("div",{className:"mt-6 p-4 bg-red-500 text-white rounded text-base font-extralight font-lexend",children:f.general})]})]})]})}),m&&e.jsx("div",{className:"fixed inset-0 bg-black/20 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-[#3f411a] border-2 border-white p-8 max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-2xl font-extralight font-lexend text-white mb-4",children:"Confirm Reservation"}),e.jsx("p",{className:"text-white mb-6 font-extralight font-lexend",children:"Ready to book your table? Please confirm your details before proceeding."}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{className:"border-b border-white pb-2",children:[e.jsx("span",{className:"text-[#f6f5c6] text-sm font-extralight font-lexend",children:"Date & Time:"}),e.jsx("p",{className:"text-white font-extralight font-lexend",children:M()})]}),e.jsxs("div",{className:"border-b border-white pb-2",children:[e.jsx("span",{className:"text-[#f6f5c6] text-sm font-extralight font-lexend",children:"Guest:"}),e.jsxs("p",{className:"text-white font-extralight font-lexend",children:[p," ",h]})]}),e.jsxs("div",{className:"border-b border-white pb-2",children:[e.jsx("span",{className:"text-[#f6f5c6] text-sm font-extralight font-lexend",children:"Contact:"}),e.jsx("p",{className:"text-white font-extralight font-lexend",children:v}),e.jsx("p",{className:"text-white font-extralight font-lexend",children:i})]})]}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx("button",{onClick:D,disabled:b,className:`flex-1 py-3 font-extralight font-lexend transition duration-200 ${b?"bg-gray-400 text-gray-600 cursor-not-allowed":"bg-white text-[#3f411a] hover:bg-[#f6f5c6]"}`,children:b?"Booking...":"Yes, Book Now"}),e.jsx("button",{onClick:Z,disabled:b,className:`flex-1 border border-white py-3 font-extralight font-lexend transition duration-200 ${b?"bg-transparent text-gray-400 cursor-not-allowed":"bg-transparent text-white hover:bg-white hover:text-[#3f411a]"}`,children:"No, Cancel"})]})]})})]})}export{we as default};
